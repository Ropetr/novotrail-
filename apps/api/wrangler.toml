name = "novotrail-api"
main = "src/index.ts"
compatibility_date = "2026-02-01"
compatibility_flags = ["nodejs_compat"]

# ============================================
# Hyperdrive — Neon PostgreSQL (São Paulo)
# ============================================
[[hyperdrive]]
binding = "HYPERDRIVE"
id = "05c0084815424cd1ba53a7fe6b1dad82"

# ============================================
# KV Namespaces
# ============================================
[[kv_namespaces]]
binding = "CACHE"
id = "e478cdb5adf5465db25655cac18eae02"

[[kv_namespaces]]
binding = "SESSIONS"
id = "54a1ed65d14d40a4b4aeecfa478a77ae"

[[kv_namespaces]]
binding = "NUVEM_FISCAL_CACHE"
id = "879c23b8835b47f4a038031afbda505c"

# ============================================
# Durable Objects
# ============================================
[[durable_objects.bindings]]
name = "SESSION_MANAGER"
class_name = "SessionManager"
script_name = "novotrail-api"

[[migrations]]
tag = "v1"
new_classes = ["SessionManager"]

# ============================================
# Analytics Engine
# ============================================
[[analytics_engine_datasets]]
binding = "ANALYTICS"

# ============================================
# R2 Buckets
# ============================================
[[r2_buckets]]
binding = "STORAGE"
bucket_name = "novotraildesktop-storage"

[[r2_buckets]]
binding = "CERTIFICATES"
bucket_name = "novotraildesktop-certificates"

[[r2_buckets]]
binding = "IMAGES"
bucket_name = "novotraildesktop-images"

# ============================================
# Queues
# ============================================
[[queues.producers]]
binding = "TASK_QUEUE"
queue = "novotrail-tasks"

[[queues.consumers]]
queue = "novotrail-tasks"
max_batch_size = 10
max_batch_timeout = 30

# ============================================
# Environment Variables
# ============================================
[vars]
ENVIRONMENT = "development"
# URLs publicas (nao sao segredos)
NUVEM_FISCAL_API_URL = "https://api-sandbox.nuvemfiscal.com.br"
NUVEM_FISCAL_TOKEN_URL = "https://api-sandbox.nuvemfiscal.com.br/oauth/token"

# ============================================
# SEGREDOS — NAO colocar aqui!
# Configurar via .dev.vars (local) ou wrangler secret put (producao):
#   wrangler secret put JWT_SECRET
#   wrangler secret put NUVEM_FISCAL_CLIENT_ID
#   wrangler secret put NUVEM_FISCAL_CLIENT_SECRET
# ============================================
