name = "erp-backend"
main = "src/index.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# ============================================
# D1 Database â€” novotraildesktop-db
# ============================================
[[d1_databases]]
binding = "DB"
database_name = "novotraildesktop-db"
database_id = "55379b36-355c-429a-b501-ade60c8c5c8a"

# ============================================
# KV Namespaces
# ============================================
[[kv_namespaces]]
binding = "CACHE"
id = "e478cdb5adf5465db25655cac18eae02"

[[kv_namespaces]]
binding = "SESSIONS"
id = "54a1ed65d14d40a4b4aeecfa478a77ae"

[[kv_namespaces]]
binding = "NUVEM_FISCAL_CACHE"
id = "879c23b8835b47f4a038031afbda505c"

# ============================================
# Durable Objects
# ============================================
[[durable_objects.bindings]]
name = "SESSION_MANAGER"
class_name = "SessionManager"
script_name = "erp-backend"

[[migrations]]
tag = "v1"
new_classes = ["SessionManager"]

# ============================================
# Analytics Engine
# ============================================
[[analytics_engine_datasets]]
binding = "ANALYTICS"

# ============================================
# R2 Buckets
# ============================================
[[r2_buckets]]
binding = "STORAGE"
bucket_name = "novotraildesktop-storage"

[[r2_buckets]]
binding = "CERTIFICATES"
bucket_name = "novotraildesktop-certificates"

[[r2_buckets]]
binding = "IMAGES"
bucket_name = "novotraildesktop-images"

# ============================================
# Queues
# ============================================
[[queues.producers]]
binding = "TASK_QUEUE"
queue = "novotraildesktop-tasks"

[[queues.consumers]]
queue = "novotraildesktop-tasks"
max_batch_size = 10
max_batch_timeout = 30

# ============================================
# Environment Variables
# ============================================
[vars]
ENVIRONMENT = "development"
JWT_SECRET = "development-secret-change-in-production"

NUVEM_FISCAL_CLIENT_ID = "r1QOKi55XgwNI3oHVoyH"
NUVEM_FISCAL_CLIENT_SECRET = "9jsQ8Ii9wMdZFZ4KX0YAycKqGryP6ho1ZFJqj9Cu"
NUVEM_FISCAL_API_URL = "https://api-sandbox.nuvemfiscal.com.br"
NUVEM_FISCAL_TOKEN_URL = "https://api-sandbox.nuvemfiscal.com.br/oauth/token"
